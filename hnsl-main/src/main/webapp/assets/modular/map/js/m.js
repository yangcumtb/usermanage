var iconColor = ["#0ca5e2", "#38d5d0", "#f6c52b", "#F77147"];
var pickerData = [];
var _location = [114.39548492431642, 37.08359831045062];
var searchFeatures = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "adcode": 210100,
                "name": "生产矿山1",
                "center": [
                    41.796767,
                    123.429096
                ],
                "centroid": [
                    42.100641,
                    123.143796
                ],
                "childrenNum": 13,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 0,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.43428607690261,
                            119.49419432349008
                        ],
                        [
                            41.4323052725957,
                            119.49420971932524
                        ],
                        [
                            41.43232098704317,
                            119.49779886226256
                        ],
                        [
                            41.434301803058695,
                            119.49778357164652
                        ],
                        [
                            41.43428607690261,
                            119.49419432349008
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210200,
                "name": "建设项目1",
                "center": [
                    38.91459,
                    121.618622
                ],
                "centroid": [
                    39.593378,
                    122.190893
                ],
                "childrenNum": 10,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 1,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [
                                41.42461888779221,
                                119.48673282761486
                            ],
                            [
                                41.41597533394228,
                                119.48680094524939
                            ],
                            [
                                41.41601540215173,
                                119.49589118966693
                            ],
                            [
                                41.42465895080342,
                                119.49582429151289
                            ],
                            [
                                41.42461888779221,
                                119.48673282761486
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.43450690239331,
                                119.48306547290373
                            ],
                            [
                                41.429464815720294,
                                119.48310553869615
                            ],
                            [
                                41.429484092647904,
                                119.48741229313492
                            ],
                            [
                                41.43452616139042,
                                119.4873725816773
                            ],
                            [
                                41.43450690239331,
                                119.48306547290373
                            ]
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210300,
                "name": "建设项目2",
                "center": [
                    41.110626,
                    122.995632
                ],
                "centroid": [
                    40.718251,
                    123.016394
                ],
                "childrenNum": 7,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 2,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [
                                41.530188000775695,
                                119.53944168528562
                            ],
                            [
                                41.52478584878793,
                                119.53948000359935
                            ],
                            [
                                41.5248238793186,
                                119.5490647468406
                            ],
                            [
                                41.53022604209821,
                                119.5490272226283
                            ],
                            [
                                41.530188000775695,
                                119.53944168528562
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.56247621270711,
                                119.50908604268682
                            ],
                            [
                                41.55707404363227,
                                119.50912696004127
                            ],
                            [
                                41.55710017613228,
                                119.51527619144315
                            ],
                            [
                                41.56250236229425,
                                119.51523580199068
                            ],
                            [
                                41.56247621270711,
                                119.50908604268682
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.56546058593733,
                                119.47145460864328
                            ],
                            [
                                41.561859214830974,
                                119.4714839769041
                            ],
                            [
                                41.56132066121961,
                                119.4718480071798
                            ],
                            [
                                41.55825950207441,
                                119.47187295887
                            ],
                            [
                                41.558273779711215,
                                119.47498958729966
                            ],
                            [
                                41.561334954144854,
                                119.47496477680306
                            ],
                            [
                                41.56187296006908,
                                119.47448089567683
                            ],
                            [
                                41.5654765228233,
                                119.47493121320497
                            ],
                            [
                                41.56546058593733,
                                119.47145460864328
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.54179810359966,
                                119.51634927330042
                            ],
                            [
                                41.53782996378186,
                                119.514820989697
                            ],
                            [
                                41.537299844911956,
                                119.51722165435592
                            ],
                            [
                                41.54126795415283,
                                119.51875009983735
                            ],
                            [
                                41.54179810359966,
                                119.51634927330042
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.53667512995332,
                                119.51854449503253
                            ],
                            [
                                41.534514271316596,
                                119.51856050476351
                            ],
                            [
                                41.53452329691265,
                                119.52071739199414
                            ],
                            [
                                41.53668415285142,
                                119.52070143622234
                            ],
                            [
                                41.53667512995332,
                                119.51854449503253
                            ]
                        ]
                    ],
                    [
                        [
                            [
                                41.54602675543049,
                                119.51559866134926
                            ],
                            [
                                41.54449614977756,
                                119.51561007374596
                            ],
                            [
                                41.544503712176606,
                                119.51740774297298
                            ],
                            [
                                41.54603431513158,
                                119.5173963719451
                            ],
                            [
                                41.54602675543049,
                                119.51559866134926
                            ]
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210400,
                "name": "生产矿山3",
                "center": [
                    41.875956,
                    123.921109
                ],
                "centroid": [
                    41.837685,
                    124.662356
                ],
                "childrenNum": 7,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 3,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.54346233266527,
                            119.75229542359295
                        ],
                        [
                            41.53932058072599,
                            119.7523112354427
                        ],
                        [
                            41.53933333578779,
                            119.75830315673497
                        ],
                        [
                            41.53519158033856,
                            119.75831858388065
                        ],
                        [
                            41.53520031848429,
                            119.76251265090704
                        ],
                        [
                            41.543483821162425,
                            119.76248234169353
                        ],
                        [
                            41.54346233266527,
                            119.75229542359295
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210500,
                "name": "废弃矿山3",
                "center": [
                    41.297909,
                    123.770519
                ],
                "centroid": [
                    41.231499,
                    124.574237
                ],
                "childrenNum": 6,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 4,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.50603902144776,
                            119.60323420245554
                        ],
                        [
                            41.50539520359693,
                            119.60228327410972
                        ],
                        [
                            41.50352878329958,
                            119.60165630051834
                        ],
                        [
                            41.497660452352356,
                            119.60168979441531
                        ],
                        [
                            41.49768346540282,
                            119.60839637822617
                        ],
                        [
                            41.506056898378006,
                            119.60834589988875
                        ],
                        [
                            41.50603902144776,
                            119.60323420245554
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210600,
                "name": "自然灾损1",
                "center": [
                    40.124296,
                    124.383044
                ],
                "centroid": [
                    40.544775,
                    124.40518
                ],
                "childrenNum": 6,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 5,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.514339880288375,
                            119.63632825954048
                        ],
                        [
                            41.506072924163036,
                            119.64164481222777
                        ],
                        [
                            41.506081117032146,
                            119.6442799118662
                        ],
                        [
                            41.510084844773985,
                            119.64329968478778
                        ],
                        [
                            41.510079266518716,
                            119.64150293021764
                        ],
                        [
                            41.51264533994126,
                            119.64148875026305
                        ],
                        [
                            41.51434742883282,
                            119.63872409542003
                        ],
                        [
                            41.514339880288375,
                            119.63632825954048
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210700,
                "name": "测试",
                "center": [
                    41.119269,
                    121.135742
                ],
                "centroid": [
                    41.461822,
                    121.618541
                ],
                "childrenNum": 7,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 6,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.385681382109055,
                            119.66932696631889
                        ],
                        [
                            41.384962765427645,
                            119.66992839460842
                        ],
                        [
                            41.3865920364729,
                            119.67290912712238
                        ],
                        [
                            41.38749075275693,
                            119.67230680184653
                        ],
                        [
                            41.385681382109055,
                            119.66932696631889
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210800,
                "name": "自然灾损2",
                "center": [
                    40.667432,
                    122.235151
                ],
                "centroid": [
                    40.391795,
                    122.456202
                ],
                "childrenNum": 6,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 7,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.577930437275235,
                            119.67499003605761
                        ],
                        [
                            41.576868006999575,
                            119.67499536737341
                        ],
                        [
                            41.57686209440611,
                            119.66666170511701
                        ],
                        [
                            41.56847054222974,
                            119.66665685094584
                        ],
                        [
                            41.56852897770551,
                            119.68749396138519
                        ],
                        [
                            41.57686656807929,
                            119.68748973781673
                        ],
                        [
                            41.576861721092094,
                            119.67915620562793
                        ],
                        [
                            41.57794212838253,
                            119.67913886668518
                        ],
                        [
                            41.577930437275235,
                            119.67499003605761
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 210900,
                "name": "废弃矿山1",
                "center": [
                    42.011796,
                    121.648962
                ],
                "centroid": [
                    42.282968,
                    121.961888
                ],
                "childrenNum": 7,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 8,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.59053048840961,
                            119.67212075421082
                        ],
                        [
                            41.58827956710512,
                            119.6721321856353
                        ],
                        [
                            41.58828913242545,
                            119.67549020979759
                        ],
                        [
                            41.590540053705396,
                            119.67547887098947
                        ],
                        [
                            41.59053048840961,
                            119.67212075421082
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 211000,
                "name": "废弃矿山2",
                "center": [
                    41.269402,
                    123.18152
                ],
                "centroid": [
                    41.184819,
                    123.251133
                ],
                "childrenNum": 7,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 9,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.56926652084845,
                            119.63721892704805
                        ],
                        [
                            41.565661250675014,
                            119.63604023366226
                        ],
                        [
                            41.56566882575997,
                            119.63843796598157
                        ],
                        [
                            41.569277820480615,
                            119.64081573635814
                        ],
                        [
                            41.56926652084845,
                            119.63721892704805
                        ]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "adcode": 211100,
                "name": "废弃矿山3",
                "center": [
                    41.124484,
                    122.06957
                ],
                "centroid": [
                    41.06851,
                    121.999309
                ],
                "childrenNum": 4,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 10,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.59274136144829,
                            119.65837651155184
                        ],
                        [
                            41.58913988988537,
                            119.65839554110725
                        ],
                        [
                            41.585247593352825,
                            119.6666910132476
                        ],
                        [
                            41.581075952251524,
                            119.6719289995338
                        ],
                        [
                            41.58108467015739,
                            119.6749868401889
                        ],
                        [
                            41.58518132728938,
                            119.67496619108941
                        ],
                        [
                            41.585169539733016,
                            119.67082884617115
                        ],
                        [
                            41.58935624672873,
                            119.67080746024445
                        ],
                        [
                            41.589331830781205,
                            119.66241228847937
                        ],
                        [
                            41.59275325394684,
                            119.66239438579689
                        ],
                        [
                            41.59274136144829,
                            119.65837651155184
                        ]
                    ]
                ]
            }
        },

        {
            "type": "Feature",
            "properties": {
                "adcode": 211400,
                "name": "建设项目6",
                "center": [
                    40.755572,
                    120.856394
                ],
                "centroid": [
                    40.620597,
                    120.21031
                ],
                "childrenNum": 6,
                "level": "city",
                "parent": {
                    "adcode": 210000
                },
                "subFeatureIndex": 13,
                "acroutes": [
                    100000,
                    210000
                ]
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            41.47385175275622,
                            119.53529138239139
                        ],
                        [
                            41.471662331651316,
                            119.53270923004698
                        ],
                        [
                            41.46953741801747,
                            119.53271250807586
                        ],
                        [
                            41.46885727604251,
                            119.53596152390526
                        ],
                        [
                            41.47087763269667,
                            119.53682100778337
                        ],
                        [
                            41.473397167045675,
                            119.53643194128108
                        ],
                        [
                            41.47385175275622,
                            119.53529138239139
                        ]
                    ]
                ]
            }
        }
    ]
};
var token = null;

var admin = null;


document.addEventListener("message", function (msg) {
    var obj = JSON.parse(msg.data);
    token = obj.token;
    _location = [obj.lat, obj.lng];

});
var lng = document.getElementById('lng');
var lat = document.getElementById('lat');
L.Control.MousePosition = L.Control.extend({
    options: {
        position: 'bottomleft',
        separator: ':',
        emptyString: '经纬度坐标',
        lngFirst: false,
        numDigits: 5,
        lngFormatter: undefined,
        latFormatter: undefined,
        prefix: ""
    },

    onAdd: function (map) {
        this._container = L.DomUtil.create('div', 'leaflet-control-mouseposition');
        L.DomEvent.disableClickPropagation(this._container);
        map.on('mousemove', this._onMouseMove, this);
        this._container.innerHTML = this.options.emptyString;
        return this._container;
    },

    onRemove: function (map) {
        map.off('mousemove', this._onMouseMove)
    },

    _onMouseMove: function (e) {
        lng = this.options.lngFormatter ? this.options.lngFormatter(e.latlng.lng) : L.Util.formatNum(e.latlng.lng, this.options.numDigits);
        lat = this.options.latFormatter ? this.options.latFormatter(e.latlng.lat) : L.Util.formatNum(e.latlng.lat, this.options.numDigits);
        var value = this.options.lngFirst ? lng + this.options.separator + lat : lat + this.options.separator + lng;
        var prefixAndValue = this.options.prefix + ' ' + value;
        this._container.innerHTML = prefixAndValue;
    }

});

L.Map.mergeOptions({
    positionControl: false
});

L.Map.addInitHook(function () {
    if (this.options.positionControl) {
        this.positionControl = new L.Control.MousePosition();
        this.addControl(this.positionControl);
    }
});

L.control.mousePosition = function (options) {
    return new L.Control.MousePosition(options);
};
layui.config({
    cacheTab: false,
    base: '/assets/common/module/'
}).extend({
    dropdown: 'dropdown/dropdown',
}).use(['layer', 'element', 'admin', 'util', 'element'], function () {
    var util = layui.util;
    // var HttpRequest = layui.HttpRequest;
    var element = layui.element;
    var gisMap;
    var $ = layui.jquery;
    admin = layui.admin;


    //打开图层选择器
    $("#layerSelBtn").click(function () {

        $(".filterShow").css("display", "none");
        $(".layerShow").css("display", "block");

        // 打开右侧面板
        admin.popupRight({
            type: 1,
            content: $('#layer-content')
        });

    })

    //打开筛选面板
    $("#layerFilterBtn").click(function () {
        $(".filterShow").css("display", "block");
        $(".layerShow").css("display", "none");

        // 打开右侧面板
        admin.popupRight({
            type: 1,
            content: $('#layer-content')
        });

    });

    $("#dropdown-menu-nav").on("click", "li", function () {
        $(".filter-group.show").removeClass("show").addClass("hide");
        $("#" + $(this).attr("data-layer") + "_filter").addClass("show").removeClass("hide");
        $(".active-layer").text($(this).text());

        $(".dropdown-menu").removeClass("dropdown-open");
    });

    // $("#searchBrt").click(function () {
    //     // 打开右侧面板
    //     admin.popupLeft({
    //         type: 1,
    //         shadeClose: false,
    //         offset: [],
    //         content: $('#list')
    //     });
    // });
    // $("#city").click(function () {
    //     // 打开右侧面板
    //     admin.popupLeft({
    //         type: 1,
    //         shadeClose: false,
    //         offset: [],
    //         content: $('#select-city'),
    //     });
    // });

    //加载树
    //数据
    // var data1 = [
    //     // {
    //     // title: '辽宁省'
    //     // , id :'辽宁省'
    //     // , children :[
    //     {
    //         title: '沈阳市'
    //         , id: '沈阳市'
    //         , children: [{
    //             title: '和平区'
    //             , id: '和平区'
    //         }, {
    //             title: '沈河区'
    //             , id: '沈河区'
    //         }, {
    //             title: '大东区'
    //             , id: '大东区'
    //         }, {
    //             title: '皇姑区'
    //             , id: '皇姑区'
    //         }, {
    //             title: '铁西区'
    //             , id: '铁西区'
    //         }, {
    //             title: '苏家屯区'
    //             , id: '苏家屯区'
    //         }, {
    //             title: '浑南区'
    //             , id: '浑南区'
    //         }, {
    //             title: '沈北新区'
    //             , id: '沈北新区'
    //         }, {
    //             title: '于洪区'
    //             , id: '于洪区'
    //         }, {
    //             title: '辽中区'
    //             , id: '辽中区'
    //         }, {
    //             title: '康平县'
    //             , id: '康平县'
    //         }, {
    //             title: '法库县'
    //             , id: '法库县'
    //         }, {
    //             title: '新民市'
    //             , id: '新民市'
    //         }, {
    //             title: '经济技术开发区'
    //             , id: '经济技术开发区'
    //         }]
    //     }, {
    //         title: '大连市'
    //         , id: '大连市'
    //         , children: [{
    //             title: '中山区'
    //             , id: '中山区'
    //         }, {
    //             title: '西岗区'
    //             , id: '西岗区'
    //         }, {
    //             title: '沙河口区'
    //             , id: '沙河口区'
    //         }, {
    //             title: '甘井子区'
    //             , id: '甘井子区'
    //         }, {
    //             title: '旅顺口区'
    //             , id: '旅顺口区'
    //         }, {
    //             title: '金州区'
    //             , id: '金州区'
    //         }, {
    //             title: '普兰店区'
    //             , id: '普兰店区'
    //         }, {
    //             title: '长海县'
    //             , id: '长海县'
    //         }, {
    //             title: '瓦房店市'
    //             , id: '瓦房店市'
    //         }, {
    //             title: '庄河市'
    //             , id: '庄河市'
    //         }]
    //     }, {
    //         title: '鞍山市'
    //         , id: '鞍山市'
    //         , children: [{
    //             title: '铁东区'
    //             , id: '铁东区'
    //         }, {
    //             title: '铁西区'
    //             , id: '铁西区'
    //         }, {
    //             title: '立山区'
    //             , id: '立山区'
    //         }, {
    //             title: '千山区'
    //             , id: '千山区'
    //         }, {
    //             title: '台安县'
    //             , id: '台安县'
    //         }, {
    //             title: '岫岩满族自治县'
    //             , id: '岫岩满族自治县'
    //         }, {
    //             title: '海城市'
    //             , id: '海城市'
    //         }, {
    //             title: '高新区'
    //             , id: '高新区'
    //         }]
    //     }, {
    //         title: '抚顺市'
    //         , id: '抚顺市'
    //         , children: [{
    //             title: '新抚区'
    //             , id: '新抚区'
    //         }, {
    //             title: '东洲区'
    //             , id: '东洲区'
    //         }, {
    //             title: '望花区'
    //             , id: '望花区'
    //         }, {
    //             title: '顺城区'
    //             , id: '顺城区'
    //         }, {
    //             title: '抚顺县'
    //             , id: '抚顺县'
    //         }, {
    //             title: '新宾满族自治县'
    //             , id: '新宾满族自治县'
    //         }, {
    //             title: '清原满族自治县'
    //             , id: '清原满族自治县'
    //         }]
    //     }, {
    //         title: '本溪市'
    //         , id: '本溪市'
    //         , children: [{
    //             title: '平山区'
    //             , id: '平山区'
    //         }, {
    //             title: '溪湖区'
    //             , id: '溪湖区'
    //         }, {
    //             title: '明山区'
    //             , id: '明山区'
    //         }, {
    //             title: '南芬区'
    //             , id: '南芬区'
    //         }, {
    //             title: '本溪满族县'
    //             , id: '本溪满族县'
    //         }, {
    //             title: '桓仁满族自治县'
    //             , id: '桓仁满族自治县'
    //         }]
    //     }, {
    //         title: '丹东市'
    //         , id: '丹东市'
    //         , children: [{
    //             title: '元宝区'
    //             , id: '元宝区'
    //         }, {
    //             title: '振兴区'
    //             , id: '振兴区'
    //         }, {
    //             title: '振安区'
    //             , id: '振安区'
    //         }, {
    //             title: '宽甸满族自治县'
    //             , id: '宽甸满族自治县'
    //         }, {
    //             title: '东港市'
    //             , id: '东港市'
    //         }, {
    //             title: '凤城市'
    //             , id: '凤城市'
    //         }]
    //     }, {
    //         title: '锦州市'
    //         , id: '锦州市'
    //         , children: [{
    //             title: '古塔区'
    //             , id: '古塔区'
    //         }, {
    //             title: '凌河区'
    //             , id: '凌河区'
    //         }, {
    //             title: '太和区'
    //             , id: '太和区'
    //         }, {
    //             title: '黑山县'
    //             , id: '黑山县'
    //         }, {
    //             title: '义县'
    //             , id: '义县'
    //         }, {
    //             title: '凌海市'
    //             , id: '凌海市'
    //         }, {
    //             title: '北镇市'
    //             , id: '北镇市'
    //         }, {
    //             title: '经济技术开发区'
    //             , id: '经济技术开发区'
    //         }]
    //     }, {
    //         title: '营口市'
    //         , id: '营口市'
    //         , children: [{
    //             title: '战前区'
    //             , id: '战前区'
    //         }, {
    //             title: '西市区'
    //             , id: '西市区'
    //         }, {
    //             title: '鲅鱼圈区'
    //             , id: '鲅鱼圈区'
    //         }, {
    //             title: '老边区'
    //             , id: '老边区'
    //         }, {
    //             title: '盖州市'
    //             , id: '盖州市'
    //         }, {
    //             title: '大石桥市'
    //             , id: '大石桥市'
    //         }]
    //     }, {
    //         title: '阜新市'
    //         , id: '阜新市'
    //         , children: [{
    //             title: '海州区'
    //             , id: '海州区'
    //         }, {
    //             title: '新邱区'
    //             , id: '新邱区'
    //         }, {
    //             title: '太平区'
    //             , id: '太平区'
    //         }, {
    //             title: '清河门区'
    //             , id: '清河门区'
    //         }, {
    //             title: '细河区'
    //             , id: '细河区'
    //         }, {
    //             title: '阜新蒙古族自治县'
    //             , id: '阜新蒙古族自治县'
    //         }, {
    //             title: '彰武县'
    //             , id: '彰武县'
    //         }]
    //     }, {
    //         title: '辽阳市'
    //         , id: '辽阳市'
    //         , children: [{
    //             title: '白塔区'
    //             , id: '白塔区'
    //         }, {
    //             title: '文圣区'
    //             , id: '文圣区'
    //         }, {
    //             title: '宏伟区'
    //             , id: '宏伟区'
    //         }, {
    //             title: '弓长岭区'
    //             , id: '弓长岭区'
    //         }, {
    //             title: '太子河区'
    //             , id: '太子河区'
    //         }, {
    //             title: '辽阳县'
    //             , id: '辽阳县'
    //         }, {
    //             title: '灯塔市'
    //             , id: '灯塔市'
    //         }]
    //     }, {
    //         title: '盘锦市'
    //         , id: '盘锦市'
    //         , children: [{
    //             title: '双台子区'
    //             , id: '双台子区'
    //         }, {
    //             title: '兴隆台区'
    //             , id: '兴隆台区'
    //         }, {
    //             title: '大洼区'
    //             , id: '大洼区'
    //         }, {
    //             title: '盘山县'
    //             , id: '盘山县'
    //         }]
    //     }, {
    //         title: '铁岭市'
    //         , id: '铁岭市'
    //         , children: [{
    //             title: '银州区'
    //             , id: '银州区'
    //         }, {
    //             title: '清河区'
    //             , id: '清河区'
    //         }, {
    //             title: '铁岭区'
    //             , id: '铁岭区'
    //         }, {
    //             title: '西丰县'
    //             , id: '西丰县'
    //         }, {
    //             title: '昌图县'
    //             , id: '昌图县'
    //         }, {
    //             title: '调兵山市'
    //             , id: '调兵山市'
    //         }, {
    //             title: '开原市'
    //             , id: '开原市'
    //         }]
    //     }, {
    //         title: '朝阳市'
    //         , id: '朝阳市'
    //         , children: [{
    //             title: '双塔区'
    //             , id: '双塔区'
    //         }, {
    //             title: '龙城区'
    //             , id: '龙城区'
    //         }, {
    //             title: '朝阳县'
    //             , id: '朝阳县'
    //         }, {
    //             title: '建平县'
    //             , id: '建平县'
    //         }, {
    //             title: '喀喇沁左翼蒙古族自治县'
    //             , id: '喀喇沁左翼蒙古族自治县'
    //         }, {
    //             title: '北票市'
    //             , id: '北票市'
    //         }, {
    //             title: '凌源市'
    //             , id: '凌源市'
    //         }]
    //     }, {
    //         title: '葫芦岛市'
    //         , id: '葫芦岛市'
    //         , children: [{
    //             title: '连山区'
    //             , id: '连山区'
    //         }, {
    //             title: '龙港区'
    //             , id: '龙港区'
    //         }, {
    //             title: '南票县'
    //             , id: '南票县'
    //         }, {
    //             title: '绥中县'
    //             , id: '绥中县'
    //         }, {
    //             title: '建昌县'
    //             , id: '建昌县'
    //         }, {
    //             title: '兴城市'
    //             , id: '兴城市'
    //         }]
    //         // }]
    //     }]
    //加载树
    // var ajax = new HttpRequest(Feng.ctxPath + "/base/baseAdmin/layuiTree", 'get');
    // var data1 = ajax.start();
    // console.log(data);
    // tree.render({
    //     elem: '#test13'
    //     ,data: data1
    //     ,showCheckbox: true  //是否显示复选框
    //     ,showLine: false  //是否开启连接线
    //     ,spread:true
    // });


    $(".filter-item").click(function () {
        $(this).siblings().removeClass("active");
        $(this).addClass("active");
    });

    /*右侧筛选按钮*/
    $("#filterBtn").click(function () {
        var params = {};
        var layerId = null;
        $(".filter-group.show li.active").each(function () {
            var code = $(this).attr("data-type");
            var value = $(this).attr("data-value");
            if (layerId == null) {
                layerId = $(this).attr("data-layer");
            }
            if (value != -1) {
                params[code] = value;
            }
        });

        if (gisMap.findLayerById(layerId) == null) {
            mui.toast("请先加载图层");
            return;
        }

        var layerConfig = layers[layerId];
        gisMap.remove(layerConfig.layer);
        searchFeatures[layerId] = [];
        drawLayer(layerId, params);

    });
    layui.use(['form', 'HttpRequest','tree'], function () {
        var HttpRequest = layui.HttpRequest;
        var tree = layui.tree;
        var ajax = new HttpRequest(Feng.ctxPath + "/base/baseAdmin/layuiTree", 'get', function (data) {
            tree.render({
                elem: '#test13',
                data: data,
                showCheckbox: true  //是否显示复选框
                ,showLine: false  //是否开启连接线
                ,spread:true
            });
        }, function (data) {
        });
        ajax.start();


    });


    $("#searchBrt").click(function () {
        var condition = $("#search-input").val();
        $("#search-list").empty();
        for (var m = 0; m < searchFeatures.features.length; m++) {
            var featureTemp = searchFeatures.features[m];
            var resultDome = "<ul class=\"mui-table-view\"><li class=\"mui-table-view-cell mui-media zoomFeature\" data-geojson=\"geojsonvalue\"><a></a><img class=\"mui-media-object mui-pull-left search-image\" src=\"/assets/modular/map/img/map/keyParcel.png\"><div class=\"mui-media-body search-title\">测试地块<p class=\"mui-ellipsis\"><span class=\"profession\">高风险</span><span class=\"profession\">低关注度</span><span class=\"profession\">在产企业</span></p></div></li></ul>";
            resultDome = resultDome.replace("测试地块", featureTemp.properties.name);
            var $resultDom = $(resultDome);
            $resultDom.appendTo($("#search-list"));
        }
        $("#searchNum").text(searchFeatures.features.length);
        for (var n = 0; n < searchFeatures.features.length; n++) {
            var fea = searchFeatures.features[n];
            var type = fea.geometry.type;
            if (type == "Polygon") {
                var coordinates = fea.geometry.coordinates;
                var polygon = L.polygon(coordinates, {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.8
                }).addTo(gisMap);
                gisMap.fitBounds(polygon.getBounds());
            }
            if (type == "MultiPolygon") {
                var coordinates = fea.geometry.coordinates;
                var polygon = L.polygon(coordinates, {color: 'red'}).addTo(gisMap);
                gisMap.fitBounds(polygon.getBounds());
            }
        }
        element.tabChange('demo', '3')

    });

    $("#modal-close").click(function () {
        document.querySelector(".mui-modal").classList.remove("mui-active");
    });

    $("#search-list").on("click", "li", function (event) {
        var name = event.currentTarget.lastElementChild.firstChild.data;
        for (var m = 0; m < searchFeatures.features.length; m++) {
            var fea = searchFeatures.features[m];
            if (fea.properties.name == name) {
                var type = fea.geometry.type;
                if (type == "Polygon") {
                    var coordinates = fea.geometry.coordinates;
                    var polygon = L.polygon(coordinates, {
                        color: 'red',
                        fillColor: '#f03',
                        fillOpacity: 0.8
                    });
                    gisMap.fitBounds(polygon.getBounds());
                }
                if (type == "MultiPolygon") {
                    var coordinates = fea.geometry.coordinates;
                    var polygon = L.polygon(coordinates, {color: 'red'});
                    gisMap.fitBounds(polygon.getBounds());
                }
            }
        }
    });

    function initMap() {
        var normalm = L.tileLayer.chinaProvider('GaoDe.Normal.Map', {
            maxZoom: 18,
            minZoom: 1
        });
        var imgm = L.tileLayer.chinaProvider('GaoDe.Satellite.Map', {
            maxZoom: 18,
            minZoom: 1
        });
        var imga = L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion', {
            maxZoom: 18,
            minZoom: 1
        });
        var normalLayer = L.layerGroup([normalm]);
        var imageLayer = L.layerGroup([imgm, imga]);
        var cor1 = L.latLng(45.30462108, 112.03515625);
        var cor2 = L.latLng(38.80251791, 133.34472656);
        var bounds = L.latLngBounds(cor1, cor2); //构建视图限制范围
        gisMap = new L.map('mapDiv',
            {
                zoom: 13,
                center: [41.67, 123.45],
                layers: [imageLayer],
                zoomControl: false,
                attributionControl: false,
                maxBounds: bounds,
                minZoom: 5,
                maxZoom: 18,
            });
        //gisMap.on('click', onMapClick);
        gisMap.on('mousemove', (e) => {
            let latlng = e.latlng;
            $("#lng").text(latlng.lng.toFixed(8));
            $("#lat").text(latlng.lat.toFixed(8));
            console.log(latlng);// {lat: 30.59, lng: 114.32}
        });

        // L.control.mousePosition().addTo(gisMap);
        function changeBaseMap(item) {
            var mapType = item.alt;
            if (mapType == "政区图") {
                if (gisMap.hasLayer(imageLayer)) {
                    gisMap.removeLayer(imageLayer);
                }
                if (!gisMap.hasLayer(normalLayer)) {
                    gisMap.addLayer(normalLayer);
                }
            } else {
                if (gisMap.hasLayer(normalLayer)) {
                    gisMap.removeLayer(normalLayer);
                }
                if (!gisMap.hasLayer(imageLayer)) {
                    gisMap.addLayer(imageLayer);
                }
            }
        }

        L.marker([41.677142, 123.464918]).addTo(gisMap);
        L.control.zoom({
            zoomInTitle: '放大',
            zoomOutTitle: '缩小',
            position: 'bottomright'
        }).addTo(gisMap);

        $("li.basemap_item").on("click", function (event) {
            changeBaseMap(event.target);
        });
    }

    function drawLayer(layerId, params) {
        var layerConfig = layers[layerId];

        if (params == null) {
            params = {};
            for (let i = 0; i < layerItems.length; i++) {
                for (let j = 0; j < layerItems[i].layers.length; j++) {
                    var item = layerItems[i].layers[j];

                    if (item.id == layerId) {
                        for (let k = 0; k < item.filterGroup.length; k++) {
                            var _filter = item.filterGroup[k];
                            if (_filter.active != -1) {
                                params[_filter.code] = _filter.active;
                            }
                        }
                    } else {
                        continue;
                    }
                }
            }
        }

        var geometryType = 'point';

        if (layerConfig.geometryType != undefined) {
            geometryType = layerConfig.geometryType;
        }

        var layer = new GeoJSONLayer({
            id: layerId,
            title: layerConfig.title,
            url: "/map/layer/getLayerByName?name=" + layerId + "&parms=" + JSON.stringify(params),
            outFields: ["*"],
            renderer: layerConfig.renderer,
            labelingInfo: layerConfig.labelingInfo,
            popupTemplate: layerConfig.popupTemplate,
            geometryType: geometryType
        });
        layerConfig.layer = layer;
        gisMap.add(layer);

        layer.queryFeatures().then(function (results) {
            $("#statis .statis-label").text(layerConfig.title);
            $("#statis .statis-num").text(results.features.length);
            searchFeatures[layerId] = results.features;

        });
    }

    function createLabel(data, _graphics) {
        for (var i = 0; i < data.length; i++) {
            var b = new Graphic({
                attributes: {
                    name: "测试"
                },
                geometry: webMercatorUtils.geographicToWebMercator({
                    type: 'point',
                    x: data[i].lat,
                    y: data[i].lng,
                    spatialReference: new SpatialReference(4326)
                }),
                dom: `<div class="infowindow quality-one" data-code="${data[i].code}" data-type="sz-auto"><div class="window">
                  <span class="regin">${data[i].fj}-${data[i].glc}</span>
				  <div class="title">
					<div>自动</div>
					<div><span class="name">${data[i].name}</span><span class="type">&nbsp;&nbsp;水质等级</span><span class="num" rel="类">Ⅰ</span></div></div>
                  <span class="no">${data[i].code}</span>
                  <span class="time">2021-03-11 08:00</span>
                  <div class="footer"></div></div></div>`,
                grade: "1"
            });
            _graphics.push(b)
        }
    }


    function initLayerDom() {
        var html = "";
        for (var i = 0; i < layerItems.length; i++) {
            var label = "<div class='item'><label class='mui-input-row'>" + layerItems[i].title + "</label>";
            var form = "<form class='mui-input-group layergroup'>";

            for (var j = 0; j < layerItems[i].layers.length; j++) {
                var item = layerItems[i].layers[j];

                var checked = "";
                if (item.checked) {
                    checked = "checked";
                    $(".active-layer").text(item.title);
                }
                form = form +
                    "<div class='mui-input-row mui-checkbox'><label><span class='icon mui-icon iconfont " + item.icon +
                    "' style='color: " + iconColor[j % 4] + ";'></span>" + item.title +
                    "</label> <input value='" + item.id +
                    "' type='checkbox' " + checked + "></div>";

                if (item.filterGroup.length != 0) {

                    $("<li data-layer='" + item.id + "'><a>" + item.title + "</a></li>").appendTo($("#dropdown-menu-nav"));
                    var show = "hide";
                    if (item.checked) {
                        show = "show";
                    }
                    var $tmpHtml = $("<div class='filter-group " + show + "' id='" + item.id +
                        "_filter'></div>");
                    for (var k = 0; k < item.filterGroup.length; k++) {
                        var fgItem = item.filterGroup[k];

                        var $fcDom = $("<div class='filter-group-content'></div>");
                        var $ul = $("<ul></ul>")
                        for (var n = 0; n < fgItem.values.length; n++) {

                            var vItem = fgItem.values[n];
                            var active = "";
                            if (fgItem.active == vItem.value) {
                                active = "active";
                            }

                            $("<li class='filter-item " + active + "' data-value='" +
                                vItem.value + "' data-type='" + fgItem.code + "' data-layer='" + item.id + "'>" + vItem
                                    .text + "</li>").appendTo($ul);
                        }
                        $ul.appendTo($fcDom);
                        $("<div class='filter-group-header'>" + fgItem.name + "</div>").appendTo($tmpHtml);
                        $fcDom.appendTo($tmpHtml);
                    }
                    $tmpHtml.appendTo($(".filter-content"))
                }

            }
            html = html + label + form + "</form></div>"
        }

        $(html).appendTo($("#layerGroup"));
    }


    function parseData(input) {
        const decoder = new TextDecoder('utf8')
        return JSON.parse(decoder.decode(input))
    }

    function toArrayBuffer(input) {
        const encoder = new TextEncoder()
        const view = encoder.encode(input)
        return view.buffer
    }

    initMap();
    initLayerDom();
});

